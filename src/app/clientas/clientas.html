<!-- TABLA DE CLIENTAS -->
<div class="container">
    <h1>Lista de clientas</h1>
    <div class="mt-3 d-flex justify-content-start align-items-center gap-3">
      <button
        class="btn btn-primary mt-3 mb-3"
        (click)="mostrarModalAgregar()">
        Agregar clienta
      </button>
      <input type="text" class="form-control w-25" placeholder="Buscar clienta"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange($event.target.value)"
      />
      <div *ngIf="loading" class="text-center my-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>

    </div>
    <table *ngIf="!loading" class="table table-striped table-hover" style="border-radius: 10px;">
    <thead style="background-color: blue;">
        <tr>
        <th scope="col" style="background-color: violet" >Nombre</th>
        <th scope="col" style="background-color: violet" >Apellido</th>
        <th scope="col" style="background-color: violet" >Teléfono</th>
        <th scope="col" style="background-color: violet" >Fecha_registro</th>
        <th scope="col" style="background-color: violet" >Acción</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let clienta of clientas">
        <td>{{clienta.nombre}}</td>
        <td>{{clienta.apellido}}</td>
        <td>{{clienta.telefono}}</td>
        <td>{{clienta.fecha_registro}}</td>
        <td>
          <button class="btn btn-danger btn-sm me-2" (click)="mostrarModalEliminar(clienta)">Eliminar</button>
          <button class="btn btn-info btn-sm me-2" (click)="abrirModalAsignarViaje(clienta)">Asignar viaje</button>
        </td>

        </tr>
    </tbody>
    </table>
    <nav class="mt-3">
      <ul class="pagination justify-content-center">

        <li class="page-item" [class.disabled]="paginaActual === 1">
          <button class="page-link" (click)="cargarClientas(paginaActual - 1)">
            Anterior
          </button>
        </li>

        <li
          class="page-item"
          *ngFor="let p of paginas"
          [class.active]="paginaActual === p"
        >
          <button class="page-link" (click)="cargarClientas(p)">
            {{ p }}
          </button>
        </li>

        <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
          <button class="page-link" (click)="cargarClientas(paginaActual + 1)">
            Siguiente
          </button>
        </li>

      </ul>
    </nav>  
</div>

<!-- MODAL DE PARA AGREGAR CLIENTA -->
<div class="modal fade" id="modalAgregarClienta" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Nueva clienta</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="guardarClienta()">

            <input class="form-control mb-2"
                placeholder="Nombre"
                [(ngModel)]="clienta.nombre"
                name="nombre">

            <input class="form-control mb-2"
                placeholder="Apellido"
                [(ngModel)]="clienta.apellido"
                name="apellido">

            <input class="form-control mb-2"
                placeholder="Teléfono"
                [(ngModel)]="clienta.telefono"
                name="telefono">

            <button
                class="btn btn-success w-100"
                type="submit"
                [disabled]="!formularioValido()">
                Guardar
            </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- MODAL DE PARA ELIMINAR CLIENTA -->
<div class="modal fade" id="modalEliminarClienta" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          ¿Estás segura de eliminar a <strong>{{ clientaSeleccionada?.nombre }} {{ clientaSeleccionada?.apellido }}</strong>?
        </h5>
        <button type="button" class="btn-close" (click)="cerrarModalEliminar()"></button>
      </div>
      <div class="modal-body text-center">
        <button class="btn btn-danger me-2" (click)="eliminarClienta()">
          Sí, eliminar
        </button>
        <button class="btn btn-secondary" (click)="cerrarModalEliminar()">
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL DE PARA ASIGNAR VIAJE A CLIENTA -->
<div class="modal fade" id="modalAsignarViaje" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Asignar viaje a {{ clientaSeleccionada?.nombre }} {{ clientaSeleccionada?.apellido }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <label for="" class="form-label">Selecciona un viaje</label>
        <select class="form-select" [(ngModel)]="viajeSeleccionadoId">
          <option [ngValue]="null">-- Selecciona --</option>
          <option [value]="viaje.id" *ngFor="let viaje of viajesDisponibles">
            {{viaje.nombre}} -- {{viaje.destino}}
          </option>
        </select>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button class="btn btn-primary" [disabled]="!viajeSeleccionadoId" (click)="asignarViaje()">Asignar</button>
      </div>

    </div>
  </div>
</div>



<div class="toast-container position-fixed top-0 end-0 p-3">
  <div
    class="toast align-items-center text-bg-success border-0"
    id="toastSuccess"
    role="alert"
  >
    <div class="d-flex">
      <div class="toast-body">
        {{ toastMensaje }}
      </div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
      ></button>
    </div>
  </div>
</div>
