<!-- TABLA DE VIAJES -->
<div class="container">
    <h1>Lista de viajes</h1>
    <div class="mt-3 d-flex justify-content-start align-items-center gap-3">
      <button
        class="btn btn-primary mt-3 mb-3"
        (click)="mostrarModalAgregar()">
        Agregar viaje
      </button>
      <input type="text" placeholder="Buscar viaje" class="form-control w-25" 
      [(ngModel)]="searchTerm"
      (input)="onSearchChange($event.target.value)"
      />
    </div>
    <div *ngIf="loading" class="text-center my-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
    </div>
    <table class="table table-striped table-hover" style="border-radius:10px">
    <thead style="background-color: blue;">
        <tr>
        <th scope="col" style="background-color: violet" >Nombre</th>
        <th scope="col" style="background-color: violet" >Destino</th>
        <th scope="col" style="background-color: violet" >Fecha_inicio</th>
        <th scope="col" style="background-color: violet" >Precio</th>
        <th scope="col" style="background-color: violet" >Acción</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let viaje of viajes">
        <td>{{viaje.nombre}}</td>
        <td>{{viaje.destino}}</td>
        <td>{{viaje.fecha_inicio}}</td>
        <td>{{viaje.precio}}</td>
        <td>
          <button class="btn btn-danger btn-sm me-2" (click)="mostrarModalEliminar(viaje)">Eliminar</button>
          <button class="btn btn-info btn-sm me-2" (click)="verClientas(viaje.id, viaje.nombre)">Ver clientas</button>
        </td>
        </tr>
    </tbody>
    </table>
      <nav class="mt-3">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="paginaActual === 1">
          <button class="page-link" (click)="cargarViajes(paginaActual - 1)">
            Anterior
          </button>
        </li>
        <li
          class="page-item"
          *ngFor="let p of paginas"
          [class.active]="paginaActual === p"
        >
          <button class="page-link" (click)="cargarViajes(p)">
            {{ p }}
          </button>
        </li>
        <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
          <button class="page-link" (click)="cargarViajes(paginaActual + 1)">
            Siguiente
          </button>
        </li>
      </ul>
    </nav> 
</div>

<!-- MODAL DE PARA AGREGAR VIAJE -->
<div class="modal fade" id="modalAgregarViaje" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Nuevo viaje</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="guardarViaje()">

            <input class="form-control mb-2"
                placeholder="Nombre"
                [(ngModel)]="viaje.nombre"
                name="nombre">

            <input class="form-control mb-2"
                placeholder="Destino"
                [(ngModel)]="viaje.destino"
                name="destino">

            <input class="form-control mb-2"
                placeholder="fecha_inicio"
                [(ngModel)]="viaje.fecha_inicio"
                name="fecha_inicio">

            <input class="form-control mb-2"
                placeholder="Precio"
                [(ngModel)]="viaje.precio"
                name="precio"
                type="number">

            <button
                class="btn btn-success w-100"
                type="submit"
                [disabled]="!formularioValido()">
                Guardar
            </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- MODAL DE PARA ELIMINAR VIAJE -->
 <div class="modal fade" id="modalEliminarViaje" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          ¿Estás segura de eliminar a <strong>{{ viajeSeleccionado?.nombre }}</strong>?
        </h5>
        <button type="button" class="btn-close" (click)="cerrarModalEliminar()"></button>
      </div>
      <div class="modal-body text-center">
        <button class="btn btn-danger me-2" (click)="eliminarViaje()">
          Sí, eliminar
        </button>
        <button class="btn btn-secondary" (click)="cerrarModalEliminar()">
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL CLIENTAS POR VIAJE -->
<div class="modal fade" id="modalClientasViaje" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">
          Clientas del viaje: {{ viajeSeleccionado }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <div *ngIf="clientas.length === 0" class="text-center text-muted">
          No hay clientas asignadas a este viaje
        </div>

        <table *ngIf="clientas.length > 0" class="table table-striped">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Teléfono</th>
              <th>Estatus</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of clientas">
              <td>{{ c.nombre }} {{ c.apellido }}</td>
              <td>{{ c.telefono }}</td>
              <td>
                <span class="badge bg-success" *ngIf="c.pivot.estatus === 'confirmada'">
                  Confirmada
                </span>
                <span class="badge bg-warning" *ngIf="c.pivot.estatus !== 'confirmada'">
                  {{ c.pivot.estatus }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>

      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">
          Cerrar
        </button>
      </div>

    </div>
  </div>
</div>

<div class="toast-container position-fixed top-0 end-0 p-3">
  <div
    class="toast align-items-center text-bg-success border-0"
    id="toastSuccess"
    role="alert"
  >
    <div class="d-flex">
      <div class="toast-body">
        {{ toastMensaje }}
      </div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
      ></button>
    </div>
  </div>
</div>
